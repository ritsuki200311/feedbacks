<div class="bg-white rounded-lg shadow-md p-4 h-80 flex flex-col">
  <div class="mb-3 h-32 flex-shrink-0">
    <% if post.images.attached? %>
      <% post.images.limit(1).each do |image| %>
        <div class="relative inline-block">
          <%= image_tag image, class: "w-32 h-32 object-cover rounded shadow-sm" %>
          <% if post.images.count > 1 %>
            <div class="absolute -top-2 -right-2 bg-blue-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">
              +<%= post.images.count - 1 %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <div class="w-32 h-32 bg-gray-100 rounded shadow-sm flex items-center justify-center">
        <div class="text-gray-400 text-4xl">üìÑ</div>
      </div>
    <% end %>
  </div>
  
  <div class="flex-grow flex flex-col">
    <h2 class="text-lg font-bold mb-2 line-clamp-2"><%= link_to post.title, post_path(post), class: "hover:underline" %></h2>
    <p class="text-gray-700 text-sm mb-3 line-clamp-3 flex-grow"><%= truncate(post.body, length: 80) %></p>
    
    <% if post.tag.present? %>
      <div class="flex flex-wrap gap-1 mb-3">
        <% post.tag.split(',').first(2).each do |tag| %>
          <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full"><%= tag %></span>
        <% end %>
      </div>
    <% end %>
    
    <div class="flex items-center justify-between mt-auto">
      <div class="flex items-center gap-2">
        <%= button_to vote_path(votable_type: 'Post', votable_id: post.id, value: 1), method: :post, class: "text-gray-500 hover:text-green-500 text-sm" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 5v14"/>
            <path d="M5 12h14"/>
          </svg>
        <% end %>
        <span class="text-gray-600 text-sm font-semibold">
          <%= post.votes.where(value: 1).count - post.votes.where(value: -1).count %>
        </span>
        <%= button_to vote_path(votable_type: 'Post', votable_id: post.id, value: -1), method: :post, class: "text-gray-500 hover:text-red-500 text-sm" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"/>
          </svg>
        <% end %>
      </div>
      <%= link_to "Ë©≥Á¥∞", post_path(post), class: "text-blue-500 hover:text-blue-700 text-sm font-semibold" %>
    </div>
  <div class="flex items-center justify-between mt-4">
    <% up_count = post.votes.where(value: 1).count %>
    <% down_count = post.votes.where(value: -1).count %>
    <% user_vote = current_user ? (post.votes.find_by(user: current_user)&.value || 0) : 0 %>
    <% total_votes = up_count + down_count %>
    
    <div class="flex items-center gap-4">
      
      <!-- „Ç≥„É°„É≥„Éà„É¢„Éº„ÉÄ„É´ -->
      <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden" 
           data-vote-target="commentModal">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl">
          <h3 class="text-lg font-semibold mb-4 text-gray-800">Ë©ï‰æ°ÁêÜÁî±„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</h3>
          <p class="text-sm text-gray-600 mb-4" data-vote-target="modalMessage">
            „Å™„Åú„Åù„ÅÜÊÄù„Å£„Åü„ÅÆ„Åã„ÇíÊõ∏„ÅÑ„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          </p>
          <textarea 
            data-vote-target="commentText"
            class="w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            rows="4"
            placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà‰ªªÊÑèÔºâ"></textarea>
          <div class="flex gap-3 mt-4">
            <button 
              type="button"
              data-action="click->vote#submitWithComment"
              class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors font-semibold">
              ÈÄÅ‰ø°
            </button>
            <button 
              type="button"
              data-action="click->vote#submitWithoutComment"
              class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
              „Ç≥„É°„É≥„Éà„Åó„Å™„ÅÑ„ÅßË©ï‰æ°„Åô„Çã
            </button>
          </div>
          <button 
            type="button"
            data-action="click->vote#hideCommentModal"
            class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-2xl leading-none">
            √ó
          </button>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <!-- „Éó„É©„ÇπÊäïÁ•®„Éú„Çø„É≥ -->
        <%= button_to vote_path(votable_type: 'Post', votable_id: post.id, value: 1), 
            method: :post, 
            class: "#{user_vote == 1 ? 'text-green-600 bg-green-100 rounded px-1 py-1 font-bold' : user_vote == -1 ? 'text-gray-400' : 'text-gray-500 hover:text-green-600'}",
            disabled: user_vote != 0 do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 5v14"/>
            <path d="M5 12h14"/>
          </svg>
        <% end %>
        
        <div class="relative w-28 h-5 bg-gray-300 rounded overflow-hidden">
          <% if user_vote == 0 %>
            <!-- Êú™ÊäïÁ•®„ÅÆÂ†¥ÂêàÔºö„Ç∞„É¨„Éº„ÅÆ„Éê„Éº -->
            <div class="absolute inset-0 flex items-center justify-center text-[10px] text-gray-700 font-semibold select-none">
              <%= total_votes %>
            </div>
          <% else %>
            <!-- ÊäïÁ•®Ê∏à„Åø„ÅÆÂ†¥ÂêàÔºö„Ç´„É©„Éï„É´„Å™„Éê„Éº„Å®ÂÜÖË®≥Ë°®Á§∫ -->
            <div class="absolute inset-0 flex">
              <% if total_votes > 0 %>
                <% up_percentage = (up_count.to_f / total_votes * 100).round(1) %>
                <% down_percentage = (down_count.to_f / total_votes * 100).round(1) %>
                
                <!-- „Éó„É©„ÇπÁ•®„ÅÆ„Éê„Éº -->
                <div class="h-full bg-green-500 relative flex items-center justify-center" style="width: <%= up_percentage %>%">
                  <% if up_count > 0 %>
                    <span class="text-[9px] text-white font-bold"><%= up_count %></span>
                  <% end %>
                </div>
                
                <!-- „Éû„Ç§„Éä„ÇπÁ•®„ÅÆ„Éê„Éº -->
                <div class="h-full bg-red-500 relative flex items-center justify-center" style="width: <%= down_percentage %>%">
                  <% if down_count > 0 %>
                    <span class="text-[9px] text-white font-bold"><%= down_count %></span>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
        
        <!-- „Éû„Ç§„Éä„ÇπÊäïÁ•®„Éú„Çø„É≥ -->
        <%= button_to vote_path(votable_type: 'Post', votable_id: post.id, value: -1), 
            method: :post, 
            class: "#{user_vote == -1 ? 'text-red-600 bg-red-100 rounded px-1 py-1 font-bold' : user_vote == 1 ? 'text-gray-400' : 'text-gray-500 hover:text-red-600'}",
            disabled: user_vote != 0 do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"/>
          </svg>
        <% end %>
      </div>
      <div class="flex items-center gap-1 text-gray-500">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          <line x1="9" y1="10" x2="15" y2="10"></line>
          <line x1="9" y1="14" x2="13" y2="14"></line>
        </svg>
        <span class="text-sm font-medium"><%= post.comments.count %></span>
      </div>
    </div>
    <%= link_to "Ë©≥Á¥∞„ÇíË¶ã„Çã", post_path(post), class: "text-blue-500 hover:text-blue-700 font-semibold" %>
  </div>
</div>
