<div class="px-4 py-8">
  <h1 class="text-3xl font-bold mb-8 text-center">æ¤œç´¢</h1>

  <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <%= form_with url: search_path, method: :get, local: true, class: "space-y-6", id: "search-form" do |form| %>
      <%= form.hidden_field :search_type, value: @search_type, id: "hidden_search_type" %>
      
      <!-- æ¤œç´¢ã‚¿ã‚¤ãƒ—é¸æŠï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ï¼‰ -->
      <div class="flex justify-center mb-6">
        <div class="inline-flex bg-gray-100 rounded-lg p-1">
          <%= form.radio_button :search_type, 'users', 
              checked: @search_type == 'users', 
              class: "sr-only",
              id: "search_type_users",
              onchange: "toggleSearchType('users')" %>
          <%= form.label :search_type_users, "ãƒ¦ãƒ¼ã‚¶ãƒ¼", 
              class: "px-6 py-2 rounded-md font-medium cursor-pointer transition-colors #{'bg-white text-blue-600 shadow' if @search_type == 'users'} #{'text-gray-600 hover:text-gray-800' if @search_type != 'users'}" %>
          
          <%= form.radio_button :search_type, 'posts', 
              checked: @search_type == 'posts', 
              class: "sr-only",
              id: "search_type_posts",
              onchange: "toggleSearchType('posts')" %>
          <%= form.label :search_type_posts, "æŠ•ç¨¿ãƒ»ã‚¿ã‚°", 
              class: "px-6 py-2 rounded-md font-medium cursor-pointer transition-colors #{'bg-white text-blue-600 shadow' if @search_type == 'posts'} #{'text-gray-600 hover:text-gray-800' if @search_type != 'posts'}" %>
        </div>
      </div>

      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
      <div id="user-form" class="<%= 'hidden' unless @search_type == 'users' %>">
        <div class="max-w-2xl mx-auto">
          <h3 class="text-lg font-medium mb-3 text-center">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢</h3>

          <!-- ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ -->
          <div class="mb-4">
            <label class="block text-sm font-medium mb-2">å¯¾è±¡ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠ</label>
            <p class="text-xs text-gray-600 mb-3">ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠã™ã‚‹ã¨è‡ªå‹•ã§æ¤œç´¢ã•ã‚Œã¾ã™</p>
            <%= form.select :genre_filter,
                options_for_select([
                  ['', ''],
                  ['ã‚¤ãƒ©ã‚¹ãƒˆãƒ»çµµç”»', 'ã‚¤ãƒ©ã‚¹ãƒˆãƒ»çµµç”»'],
                  ['ãƒãƒ³ã‚¬ãƒ»ã‚³ãƒŸãƒƒã‚¯', 'ãƒãƒ³ã‚¬ãƒ»ã‚³ãƒŸãƒƒã‚¯'],
                  ['å°èª¬ãƒ»è©©ãƒ»ã‚¨ãƒƒã‚»ã‚¤', 'å°èª¬ãƒ»è©©ãƒ»ã‚¨ãƒƒã‚»ã‚¤'],
                  ['éŸ³æ¥½åˆ¶ä½œãƒ»ä½œè©ä½œæ›²', 'éŸ³æ¥½åˆ¶ä½œãƒ»ä½œè©ä½œæ›²'],
                  ['æ˜ åƒåˆ¶ä½œãƒ»å‹•ç”»ç·¨é›†', 'æ˜ åƒåˆ¶ä½œãƒ»å‹•ç”»ç·¨é›†'],
                  ['ã‚²ãƒ¼ãƒ åˆ¶ä½œãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°', 'ã‚²ãƒ¼ãƒ åˆ¶ä½œãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°'],
                  ['ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯', 'ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯'],
                  ['å†™çœŸãƒ»æ’®å½±æŠ€è¡“', 'å†™çœŸãƒ»æ’®å½±æŠ€è¡“'],
                  ['èˆå°ãƒ»æ¼”åŠ‡ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹', 'èˆå°ãƒ»æ¼”åŠ‡ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹'],
                  ['æ‰‹èŠ¸ãƒ»ã‚¯ãƒ©ãƒ•ãƒˆ', 'æ‰‹èŠ¸ãƒ»ã‚¯ãƒ©ãƒ•ãƒˆ'],
                  ['ãã®ä»–', 'ãã®ä»–']
                ], @genre_filter),
                { prompt: "ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„" },
                {
                  class: "w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500",
                  onchange: "this.form.submit();"
                } %>
          </div>

          <!-- ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ -->
          <div class="flex gap-2">
            <%= form.text_field :query, value: @query,
                placeholder: "IDã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ",
                class: "flex-1 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" %>
            <%= form.submit "æ¤œç´¢", class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium" %>
          </div>
        </div>
      </div>

      <!-- æŠ•ç¨¿ãƒ»ã‚¿ã‚°æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
      <div id="post-form" class="<%= 'hidden' unless @search_type == 'posts' %>">
        <h3 class="text-lg font-medium mb-4 text-center">æŠ•ç¨¿ãƒ»ã‚¿ã‚°æ¤œç´¢</h3>
        
        <!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ -->
        <div class="mb-4">
          <label class="block text-sm font-medium mb-2">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</label>
          <%= form.text_field :query, value: @query, 
              placeholder: "ã‚¿ã‚¤ãƒˆãƒ«ã‚„å†…å®¹ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", 
              class: "w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" %>
        </div>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <!-- å‰µä½œã®ç¨®é¡ -->
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-medium mb-3">å‰µä½œã®ç¨®é¡</h4>
            <div class="space-y-2">
              <label class="flex items-center">
                <%= form.radio_button :creation_type, '', checked: @creation_type.blank?, class: "form-radio h-4 w-4 text-blue-600" %>
                <span class="ml-2 text-sm">ã™ã¹ã¦</span>
              </label>
              <% if defined?(@creation_types) && @creation_types %>
                <% @creation_types.each do |creation_type| %>
                  <label class="flex items-center">
                    <%= form.radio_button :creation_type, creation_type, 
                        checked: @creation_type == creation_type, 
                        class: "form-radio h-4 w-4 text-blue-600" %>
                    <span class="ml-2 text-sm"><%= creation_type %></span>
                  </label>
                <% end %>
              <% end %>
            </div>
          </div>

          <!-- ã‚¿ã‚°é¸æŠ -->
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-medium mb-3">ã‚¿ã‚°</h4>
            <div class="space-y-2 max-h-32 overflow-y-auto">
              <% if defined?(@tag_options) && @tag_options %>
                <% @tag_options.each do |tag| %>
                  <label class="flex items-center">
                    <%= form.check_box :tag_list, 
                        { checked: (@tag_list&.include?(tag) || false), multiple: true }, 
                        tag, "" %>
                    <span class="ml-2 text-sm"><%= tag %></span>
                  </label>
                <% end %>
              <% end %>
            </div>
          </div>

          <!-- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚° -->
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-medium mb-3">ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h4>
            <div class="space-y-2">
              <label class="flex items-center">
                <%= form.radio_button :request_tag, '', checked: @request_tag.blank?, class: "form-radio h-4 w-4 text-blue-600" %>
                <span class="ml-2 text-sm">ã™ã¹ã¦</span>
              </label>
              <% if defined?(@request_tags) && @request_tags %>
                <% @request_tags.each do |request_tag| %>
                  <label class="flex items-center">
                    <%= form.radio_button :request_tag, request_tag, 
                        checked: @request_tag == request_tag, 
                        class: "form-radio h-4 w-4 text-blue-600" %>
                    <span class="ml-2 text-sm"><%= request_tag %></span>
                  </label>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>

        <!-- æ¤œç´¢ãƒœã‚¿ãƒ³ -->
        <div class="text-center">
          <%= form.submit "æ¤œç´¢", class: "bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- æ¤œç´¢çµæœ -->
  <% if @results && @results.any? %>
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-bold mb-4">
        æ¤œç´¢çµæœ: <%= @results.count %>ä»¶
      </h2>
      
      <% if @search_type == 'users' %>
        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢çµæœ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <% @results.each do |user| %>
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer"
                 onclick="showUserProfile(<%= user.id %>, '<%= escape_javascript(user.name) %>', '<%= escape_javascript(user.supporter_profile&.age_group || '') %>', '<%= escape_javascript(user.supporter_profile&.creation_experience || '') %>', <%= raw (user.supporter_profile&.support_genres || []).to_json %>, <%= raw (user.supporter_profile&.interests || []).to_json %>, '<%= escape_javascript(user.supporter_profile&.favorite_artists || '') %>', '<%= user.rank %>')"
                 data-user-id="<%= user.id %>">
              <h3 class="font-semibold mb-2"><%= user.name %></h3>
              <p class="text-sm text-gray-600 mb-2">ID: <%= user.id %> | ãƒ©ãƒ³ã‚¯: <%= user.rank %></p>
              <% if user.supporter_profile&.support_genres&.any? %>
                <p class="text-sm text-blue-600 mb-2">å°‚é–€: <%= user.supporter_profile.support_genres.join(', ') %></p>
              <% end %>
              <% if user.supporter_profile&.creation_experience %>
                <p class="text-xs text-gray-500">çµŒé¨“: <%= user.supporter_profile.creation_experience %></p>
              <% end %>
              <div class="mt-3 flex gap-2">
                <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm"
                        onclick="event.stopPropagation(); testModal();">
                  ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
                </button>
                <%= link_to "ãƒã‚¤ãƒšãƒ¼ã‚¸", user_path(user),
                    class: "inline-block bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm",
                    onclick: "event.stopPropagation();" %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <!-- æŠ•ç¨¿æ¤œç´¢çµæœ -->
        <div style="background-color: #f9f9f9; padding: 1rem;">
          <% @results.each_with_index do |post, index| %>
            <%= link_to post_path(post), style: "text-decoration: none; color: inherit; display: inline-block;" do %>
              <div style="display: inline-block; width: 280px; height: 350px; margin: 15px; overflow: hidden; border: 1px solid #e5e7eb; border-radius: 8px; background-color: white; vertical-align: top; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; transition: box-shadow 0.2s;">
                <div style="padding: 15px; height: 100%; display: flex; flex-direction: column;">
                  <h3 style="font-size: 16px; font-weight: bold; margin-bottom: 10px; color: #1f2937;"><%= post.title %></h3>
                
                  <% if post.images.attached? %>
                    <div style="margin-bottom: 10px; flex-shrink: 0;">
                      <%= image_tag post.images.first, style: "width: 100%; height: 120px; object-fit: cover; border-radius: 4px;" %>
                    </div>
                  <% end %>
                  
                  <p style="font-size: 14px; color: #374151; line-height: 1.4; margin-bottom: 8px;"><%= truncate(post.body, length: 60) %></p>
                  
                  <!-- æŠ•ç¥¨ã¨ã‚³ãƒ¡ãƒ³ãƒˆæ•° -->
                  <div style="margin-top: auto; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                    <% up_count = post.votes.where(value: 1).count %>
                    <% down_count = post.votes.where(value: -1).count %>
                    <% total_votes = up_count + down_count %>
                    
                    <!-- æŠ•ç¥¨ãƒãƒ¼ -->
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                      <svg xmlns="http://www.w3.org/2000/svg" style="width: 12px; height: 12px; color: #059669;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 5v14"/>
                        <path d="M5 12h14"/>
                      </svg>
                      
                      <div style="position: relative; width: 120px; height: 16px; background-color: #f3f4f6; border-radius: 8px; overflow: hidden;">
                        <% if total_votes > 0 %>
                          <% up_percentage = (up_count.to_f / total_votes * 100).round(1) %>
                          <% down_percentage = (down_count.to_f / total_votes * 100).round(1) %>
                          
                          <!-- ãƒ—ãƒ©ã‚¹ç¥¨ã®ãƒãƒ¼ -->
                          <div style="position: absolute; left: 0; top: 0; height: 100%; background-color: #10b981; display: flex; align-items: center; justify-content: center; width: <%= up_percentage %>%;">
                            <% if up_count > 0 %>
                              <span style="font-size: 10px; color: white; font-weight: bold;"><%= up_count %></span>
                            <% end %>
                          </div>
                          
                          <!-- ãƒã‚¤ãƒŠã‚¹ç¥¨ã®ãƒãƒ¼ -->
                          <div style="position: absolute; right: 0; top: 0; height: 100%; background-color: #ef4444; display: flex; align-items: center; justify-content: center; width: <%= down_percentage %>%;">
                            <% if down_count > 0 %>
                              <span style="font-size: 10px; color: white; font-weight: bold;"><%= down_count %></span>
                            <% end %>
                          </div>
                        <% else %>
                          <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 10px; color: #6b7280;">0</span>
                          </div>
                        <% end %>
                      </div>
                      
                      <svg xmlns="http://www.w3.org/2000/svg" style="width: 12px; height: 12px; color: #dc2626;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14"/>
                      </svg>
                      <span style="font-size: 12px; color: #6b7280;">ğŸ’¬ <%= post.comments.count %></span>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
            <% if (index + 1) % 3 == 0 %>
              <br>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% elsif defined?(@results) %>
    <div class="bg-white rounded-lg shadow-md p-6 text-center">
      <div class="text-4xl mb-4">ğŸ”</div>
      <p class="text-gray-500">æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
      <p class="text-sm text-gray-400 mt-2">åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„</p>
    </div>
  <% end %>
</div>

<!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
  <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold" id="modalUserName">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</h3>
      <button onclick="closeUserProfile()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
    </div>

    <div class="space-y-4">
      <div>
        <span class="inline-block bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded" id="modalUserRank">Aãƒ©ãƒ³ã‚¯</span>
      </div>

      <div id="modalAgeGroup" class="hidden">
        <h4 class="font-semibold text-gray-700 mb-1">å¹´ä»£</h4>
        <p class="text-gray-600" id="modalAgeGroupText"></p>
      </div>

      <div id="modalCreationExperience" class="hidden">
        <h4 class="font-semibold text-gray-700 mb-1">å‰µä½œçµŒé¨“</h4>
        <p class="text-gray-600" id="modalCreationExperienceText"></p>
      </div>

      <div id="modalSupportGenres" class="hidden">
        <h4 class="font-semibold text-gray-700 mb-1">å°‚é–€ã‚¸ãƒ£ãƒ³ãƒ«</h4>
        <div class="flex flex-wrap gap-2" id="modalSupportGenresContainer"></div>
      </div>

      <div id="modalInterests" class="hidden">
        <h4 class="font-semibold text-gray-700 mb-1">é–¢å¿ƒã®ã‚ã‚‹åˆ†é‡</h4>
        <div class="flex flex-wrap gap-2" id="modalInterestsContainer"></div>
      </div>

      <div id="modalFavoriteArtists" class="hidden">
        <h4 class="font-semibold text-gray-700 mb-1">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã§ãã‚‹ã“ã¨</h4>
        <p class="text-gray-600 text-sm leading-relaxed" id="modalFavoriteArtistsText"></p>
      </div>
    </div>

    <div class="mt-6 flex gap-3">
      <button onclick="selectUser()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
        ã“ã®äººã‚’é¸ã¶
      </button>
      <button onclick="closeUserProfile()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
        é–‰ã˜ã‚‹
      </button>
    </div>
  </div>
</div>

<script>
let currentSelectedUserId = null;

function testModal() {
  console.log('testModal called');
  const modal = document.getElementById('profileModal');
  console.log('Modal element:', modal);
  if (modal) {
    modal.classList.remove('hidden');
    console.log('Modal should be visible now');
  } else {
    console.error('Modal element not found');
  }
}

function showUserProfile(userId, userName, ageGroup, creationExperience, supportGenres, interests, favoriteArtists, rank) {
  console.log('showUserProfile called with:', {
    userId, userName, ageGroup, creationExperience, supportGenres, interests, favoriteArtists, rank
  });

  currentSelectedUserId = userId;

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ©ãƒ³ã‚¯ã‚’è¨­å®š
  document.getElementById('modalUserName').textContent = userName;
  document.getElementById('modalUserRank').textContent = rank + 'ãƒ©ãƒ³ã‚¯';

  // å¹´ä»£
  const ageGroupDiv = document.getElementById('modalAgeGroup');
  const ageGroupText = document.getElementById('modalAgeGroupText');
  if (ageGroup && ageGroup.trim() !== '') {
    ageGroupText.textContent = ageGroup;
    ageGroupDiv.classList.remove('hidden');
  } else {
    ageGroupDiv.classList.add('hidden');
  }

  // å‰µä½œçµŒé¨“
  const creationExpDiv = document.getElementById('modalCreationExperience');
  const creationExpText = document.getElementById('modalCreationExperienceText');
  if (creationExperience && creationExperience.trim() !== '') {
    creationExpText.textContent = creationExperience;
    creationExpDiv.classList.remove('hidden');
  } else {
    creationExpDiv.classList.add('hidden');
  }

  // å°‚é–€ã‚¸ãƒ£ãƒ³ãƒ«
  const supportGenresDiv = document.getElementById('modalSupportGenres');
  const supportGenresContainer = document.getElementById('modalSupportGenresContainer');
  if (supportGenres && supportGenres.length > 0) {
    supportGenresContainer.innerHTML = '';
    supportGenres.forEach(genre => {
      const span = document.createElement('span');
      span.className = 'bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded';
      span.textContent = genre;
      supportGenresContainer.appendChild(span);
    });
    supportGenresDiv.classList.remove('hidden');
  } else {
    supportGenresDiv.classList.add('hidden');
  }

  // é–¢å¿ƒã®ã‚ã‚‹åˆ†é‡
  const interestsDiv = document.getElementById('modalInterests');
  const interestsContainer = document.getElementById('modalInterestsContainer');
  if (interests && interests.length > 0) {
    interestsContainer.innerHTML = '';
    interests.forEach(interest => {
      const span = document.createElement('span');
      span.className = 'bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded';
      span.textContent = interest;
      interestsContainer.appendChild(span);
    });
    interestsDiv.classList.remove('hidden');
  } else {
    interestsDiv.classList.add('hidden');
  }

  // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã§ãã‚‹ã“ã¨
  const favoriteArtistsDiv = document.getElementById('modalFavoriteArtists');
  const favoriteArtistsText = document.getElementById('modalFavoriteArtistsText');
  if (favoriteArtists && favoriteArtists.trim() !== '') {
    favoriteArtistsText.textContent = favoriteArtists;
    favoriteArtistsDiv.classList.remove('hidden');
  } else {
    favoriteArtistsDiv.classList.add('hidden');
  }

  // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  document.getElementById('profileModal').classList.remove('hidden');
}

function closeUserProfile() {
  document.getElementById('profileModal').classList.add('hidden');
  currentSelectedUserId = null;
}

function selectUser() {
  if (currentSelectedUserId) {
    // ã“ã“ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠã®å‡¦ç†ã‚’å®Ÿè£…
    // ä¾‹: ãƒ•ã‚©ãƒ¼ãƒ ã«é¸æŠã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’è¨­å®šã€ã¾ãŸã¯æ¬¡ã®ãƒšãƒ¼ã‚¸ã«é·ç§»
    alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ID ' + currentSelectedUserId + ' ãŒé¸æŠã•ã‚Œã¾ã—ãŸ');
    closeUserProfile();
  }
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
document.getElementById('profileModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeUserProfile();
  }
});

function toggleSearchType(searchType) {
  console.log('Toggle search type:', searchType);
  
  // éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’æ›´æ–°
  const hiddenField = document.getElementById('hidden_search_type');
  hiddenField.value = searchType;
  
  // ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
  const userForm = document.getElementById('user-form');
  const postForm = document.getElementById('post-form');
  
  if (searchType === 'users') {
    userForm.classList.remove('hidden');
    postForm.classList.add('hidden');
    updateLabelStyles('users');
  } else if (searchType === 'posts') {
    userForm.classList.add('hidden');
    postForm.classList.remove('hidden');
    updateLabelStyles('posts');
  }
}

function updateLabelStyles(activeType) {
  const userLabel = document.querySelector('label[for="search_type_users"]');
  const postLabel = document.querySelector('label[for="search_type_posts"]');
  
  // å…¨ã¦ã®ãƒ©ãƒ™ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
  userLabel.className = userLabel.className.replace(
    /bg-white text-blue-600 shadow|text-gray-600 hover:text-gray-800/g, 
    ''
  );
  postLabel.className = postLabel.className.replace(
    /bg-white text-blue-600 shadow|text-gray-600 hover:text-gray-800/g, 
    ''
  );
  
  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ©ãƒ™ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š
  if (activeType === 'users') {
    userLabel.className += ' bg-white text-blue-600 shadow';
    postLabel.className += ' text-gray-600 hover:text-gray-800';
  } else {
    postLabel.className += ' bg-white text-blue-600 shadow';
    userLabel.className += ' text-gray-600 hover:text-gray-800';
  }
}
</script>