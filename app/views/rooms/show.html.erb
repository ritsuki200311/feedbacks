<div class="chat-container">
  <div class="chat-header">
    <div class="chat-header-back-button">
      <%= link_to "‚Üê", rooms_path, class: "back-link" %>
    </div>
    <h2><%= @other_user&.name || "„ÉÅ„É£„ÉÉ„Éà„É´„Éº„É†" %></h2>
  </div>
  <div class="chat-box" id="chat-box">
    <% @messages.each do |message| %>
      <div class="message-row <%= message.user_id == current_user.id ? 'sent' : 'received' %>">
        <div class="message">
          <% if message.post_message? %>
            <!-- ÊäïÁ®øÂÖ±Êúâ„É°„ÉÉ„Çª„Éº„Ç∏ -->
            <div class="message-body post-share-message">
              <div class="post-share-header">
                <span class="post-share-icon">üé®</span>
                <%= message.body %>
              </div>
              <% if message.post.images.attached? %>
                <%= link_to post_path(message.post), class: "post-image-link" do %>
                  <div class="post-image-container">
                    <%= image_tag message.post.images.first, class: "post-share-image" %>
                    <div class="post-overlay">
                      <span class="view-post-text">ÊäïÁ®ø„ÇíË¶ã„Çã</span>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <%= link_to post_path(message.post), class: "post-link-only" do %>
                  <div class="post-no-image">
                    <span class="post-title"><%= message.post.title %></span>
                    <span class="view-post-text">ÊäïÁ®ø„ÇíË¶ã„Çã ‚Üí</span>
                  </div>
                <% end %>
              <% end %>
              <div class="post-details">
                <span class="post-title-small">„Äå<%= truncate(message.post.title, length: 30) %>„Äç</span>
              </div>
            </div>
          <% else %>
            <!-- ÈÄöÂ∏∏„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏ -->
            <div class="message-body">
              <%= message.body %>
            </div>
          <% end %>
          <div class="message-time">
            <%= message.created_at.strftime("%H:%M") %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  <div class="message-form-container">
    <%= form_with(model: [@room, @message], local: true, html: { class: "message-form" }) do |form| %>
      <%= form.text_area :body, rows: 1, placeholder: "„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ‚Ä¶" %>
      <%= form.submit "ÈÄÅ‰ø°", class: "send-button" %>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const chatBox = document.getElementById("chat-box");
    chatBox.scrollTop = chatBox.scrollHeight;
  });
</script>