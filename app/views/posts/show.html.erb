<%= link_to "← ホームに戻る", root_path %>

<h1><%= @post.title %></h1>
<p><%= @post.body %></p>

<% if @post.thumbnail.attached? %>
  <div>
    <%= image_tag @post.thumbnail, style: "max-width: 200px; height: auto;" %>
  </div>
<% end %>

<% if @post.video.attached? %>
  <div>
    <video width="400" controls>
      <source src="<%= url_for(@post.video) %>" type="<%= @post.video.content_type %>">
      お使いのブラウザは video タグをサポートしていません。
    </video>
  </div>
<% else %>
  <p>動画はありません</p>
<% end %>

<h3>コメント</h3>

<!-- コメント一覧を表示 -->
<div id="comments_for_post_<%= @post.id %>">
  <% if @post.comments.any? %>
    <% @post.comments.each do |comment| %>
      <div class="comment">
        <% if comment.user == current_user %>
          <p><strong>あなた:</strong> <%= comment.body %></p>
        <% elsif comment.user.present? %> <!-- comment.userがnilでない場合のみ名前を表示 -->
          <p><strong><%= comment.user.name %>:</strong> <%= comment.body %></p>
        <% else %>
          <p><strong>匿名:</strong> <%= comment.body %></p> <!-- userがnilの場合は"匿名"と表示 -->
        <% end %>
        <small>
          <% if comment.created_at.present? %> <!-- created_atがnilでない場合のみ表示 -->
            <%= comment.created_at.strftime("%Y-%m-%d %H:%M") %>
          <% else %>
            <%= "日時不明" %> <!-- created_atがnilの場合 -->
          <% end %>
        </small>
      </div>
    <% end %>
  <% else %>
    <p>コメントはありません。</p>
  <% end %>
</div>
