<h1>ホーム画面</h1>

<!-- ナビゲーションリンク -->
<nav>
  <%= link_to "投稿検索", search_posts_path, class: "btn" %>
  <%= link_to "新規投稿", new_post_path %>
  <%= link_to "マイページ", mypage_path, class: "btn" %>
  <%= link_to "ログアウト", destroy_user_session_path, method: :delete, data: { turbo: false, confirm: "本当にログアウトしますか？" }, class: "btn" %>
</nav>

<hr>

<% if user_signed_in? %>
  <p>ようこそ、<%= current_user.name %> さん！</p>
  <p>メール: <%= current_user.email %></p>
<% else %>
  <p>ログインしていません。</p>
<% end %>

<h1>投稿一覧</h1>

<% if @posts.any? %>
  <% @posts.each do |post| %>
    <div class="post">
      <h2><%= link_to post.title, post_path(post) %></h2>
      <p><%= truncate(post.body, length: 100) %></p>
      <small><%= post.created_at.strftime("%Y-%m-%d %H:%M") %></small>

      <% if post.thumbnail.attached? %>
        <div>
          <%= image_tag post.thumbnail, style: "max-width: 200px; height: auto;" %>
        </div>
      <% end %>

      <% if post.video.attached? %>
        <div>
          <video width="400" controls>
            <source src="<%= url_for(post.video) %>" type="<%= post.video.content_type %>">
            お使いのブラウザは video タグをサポートしていません。
          </video>
        </div>
      <% else %>
        <p>動画はありません</p>
      <% end %>

      <!-- コメント投稿フォーム -->
      <div>
        <%= form_with model: [post, post.comments.build], local: true do |form| %>
          <div>
            <%= form.label :body, "コメント" %>
            <%= form.text_area :body, rows: 3 %>
          </div>
          <div>
            <%= form.submit "コメントする" %>
          </div>
        <% end %>
      </div>

      <!-- 削除ボタン -->
      <!-- 削除ボタン -->
<div>
  <%= link_to "削除", post_path(post), method: :delete, data: { confirm: "本当に削除しますか？" } %>
</div>

    </div>
    <hr>
  <% end %>
<% else %>
  <p>まだ投稿がありません。</p>
<% end %>