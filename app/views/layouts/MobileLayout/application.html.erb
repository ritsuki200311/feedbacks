<!DOCTYPE html>
<html>
  <head>
    <title>„Ç¢„Éó„É™Âêç</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, user-scalable=0, viewport-fit=cover">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "tailwind", "application", "data-turbo-track": "reload", preload: false %>
    <%= render 'layouts/shared/common_styles' %>
    <%= render 'layouts/shared/mobile_styles' %>
    <%= render 'layouts/shared/stimulus_app' %>
  </head>

  <body class="bg-gray-100 text-gray-800 pb-24">
    <!-- „Éè„É≥„Éê„Éº„Ç¨„Éº„É°„Éã„É•„Éº„Éú„Çø„É≥ -->
    <div class="fixed top-4 right-4 z-50">
      <button id="hamburger-btn" class="bg-white p-2 rounded-md shadow-lg border">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- „Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>

    <div class="flex">
      <!-- „É¢„Éê„Ç§„É´Áî®„Çµ„Ç§„Éâ„Éê„ÉºÔºà„Çπ„É©„Ç§„ÉâÂºèÔºâ -->
      <div id="sidebar" class="fixed top-0 left-0 z-50 w-64 h-screen bg-gray-50 border-r border-gray-200 p-4 overflow-y-auto transform -translate-x-full transition-transform duration-300" style="transform: translateX(-100%);">
        <%= render 'layouts/sidebar' %>
      </div>

      <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
      <main id="main-content" class="flex-1 p-4 pt-16 w-full">
        <% if notice %>
          <div class="bg-green-100 text-green-800 p-4 rounded mb-4"><%= notice %></div>
        <% end %>

        <% if alert %>
          <div class="bg-red-100 text-red-800 p-4 rounded mb-4"><%= alert %></div>
        <% end %>

        <%= yield %>
      </main>
    </div>

    <!-- ‰∏ãÈÉ®„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Éê„Éº -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50 transition-opacity duration-300">
      <div class="grid grid-cols-5 h-20">
        <%= link_to root_path, class: "flex flex-col items-center justify-center py-2 #{'text-blue-600' if request.path == root_path} #{'text-gray-600' if request.path != root_path} hover:text-blue-600 transition-colors" do %>
          <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          <span class="text-xs">„Éõ„Éº„É†</span>
        <% end %>

        <%= link_to search_path, class: "flex flex-col items-center justify-center py-2 #{'text-blue-600' if request.path == search_path} #{'text-gray-600' if request.path != search_path} hover:text-blue-600 transition-colors" do %>
          <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <span class="text-xs">Ê§úÁ¥¢</span>
        <% end %>

        <%= link_to new_post_path, class: "flex flex-col items-center justify-center py-2 #{'text-blue-600' if request.path == new_post_path} #{'text-gray-600' if request.path != new_post_path} hover:text-blue-600 transition-colors" do %>
          <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          <span class="text-xs">Êñ∞Ë¶èÊäïÁ®ø</span>
        <% end %>

        <% if user_signed_in? %>
          <%= link_to rooms_path, class: "flex flex-col items-center justify-center py-2 #{'text-blue-600' if request.path == rooms_path} #{'text-gray-600' if request.path != rooms_path} hover:text-blue-600 transition-colors" do %>
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 4v-4z"></path>
            </svg>
            <span class="text-xs">DM</span>
          <% end %>
        <% else %>
          <div class="flex flex-col items-center justify-center py-2 text-gray-400">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 4v-4z"></path>
            </svg>
            <span class="text-xs">DM</span>
          </div>
        <% end %>

        <% if user_signed_in? %>
          <%= link_to mypage_path, class: "flex flex-col items-center justify-center py-2 #{'text-blue-600' if request.path == mypage_path} #{'text-gray-600' if request.path != mypage_path} hover:text-blue-600 transition-colors" do %>
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span class="text-xs">„Éû„Ç§„Éö„Éº„Ç∏</span>
          <% end %>
        <% else %>
          <%= link_to new_user_session_path, class: "flex flex-col items-center justify-center py-2 text-gray-600 hover:text-blue-600 transition-colors" do %>
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span class="text-xs">„É≠„Ç∞„Ç§„É≥</span>
          <% end %>
        <% end %>
      </div>
    </nav>

    <!-- „É¢„Éê„Ç§„É´„Ç≥„É°„É≥„Éà„Éî„É≥Âàá„ÇäÊõø„Åà„Éú„Çø„É≥ -->
    <% if controller_name == 'posts' && (action_name == 'show' || action_name == 'index') || controller_name == 'home' %>
      <div class="fixed bottom-24 right-4 z-40" data-controller="global-comment-pins">
        <button type="button"
                data-action="click->global-comment-pins#toggleGlobalPins"
                data-global-comment-pins-target="toggleButton"
                class="w-16 h-16 bg-emerald-300 text-white rounded-full shadow-xl hover:bg-emerald-400 transition-all duration-300 active:scale-95 flex items-center justify-center">
          <span data-global-comment-pins-target="toggleIcon" class="text-2xl">üìç</span>
        </button>
      </div>
    <% end %>

    <script>
      // „É¢„Éê„Ç§„É´„É°„Éã„É•„Éº„ÅÆÂà∂Âæ°
      document.addEventListener('DOMContentLoaded', function() {
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        if (hamburgerBtn && sidebar && overlay) {
          hamburgerBtn.addEventListener('click', function() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
          });

          overlay.addEventListener('click', function() {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
          });

          document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
              sidebar.classList.add('-translate-x-full');
              overlay.classList.add('hidden');
            }
          });
        }
      });

      // „Çπ„ÇØ„É≠„Éº„É´ÊôÇ„Å´„Éê„Éº„ÇíÈÄèÊòé„Å´„Åô„Çã
      (function() {
        let lastScrollTop = 0;
        const bottomNav = document.getElementById('bottom-nav');

        if (!bottomNav) return;

        window.addEventListener('scroll', function() {
          const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

          if (scrollTop > lastScrollTop && scrollTop > 100) {
            // ‰∏ã„Å´„Çπ„ÇØ„É≠„Éº„É´‰∏≠
            bottomNav.style.opacity = '0.2';
          } else {
            // ‰∏ä„Å´„Çπ„ÇØ„É≠„Éº„É´‰∏≠„ÄÅ„Åæ„Åü„ÅØÊúÄ‰∏äÈÉ®
            bottomNav.style.opacity = '1';
          }

          lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }, false);
      })();
    </script>
  </body>
</html>
