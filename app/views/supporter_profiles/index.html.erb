<div class="max-w-6xl mx-auto p-6">
  <!-- ページタイトル -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">サポータープロフィール検索</h1>
    <p class="text-gray-600">フリーワードでサポーターを検索できます</p>
    <p class="text-sm text-gray-500 mt-1">
      検索対象：フィードバックできること、よく見るジャンル、創作ジャンル、創作経験、年齢層など
    </p>
  </div>

  <!-- 検索フォーム -->
  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <%= form_with url: supporter_profiles_path, method: :get, local: true, class: "space-y-4" do |f| %>
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
          <%= f.text_field :search, 
              value: params[:search], 
              placeholder: "フリーワード検索（例：デジタルイラスト、小説、DTM、ミックス、構図、キャラクター、20代など）",
              class: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-lg" %>
        </div>
        <div class="flex gap-2">
          <%= f.submit "検索", class: "bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors" %>
          <%= link_to "クリア", supporter_profiles_path, class: "bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- 検索結果表示 -->
  <% if params[:search].present? %>
    <div class="mb-4">
      <p class="text-gray-600">
        「<span class="font-bold text-indigo-600"><%= params[:search] %></span>」の検索結果: 
        <span class="font-bold"><%= @supporter_profiles.total_count if @supporter_profiles.respond_to?(:total_count) %></span>件
      </p>
    </div>
  <% end %>

  <!-- プロフィール一覧 -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% @supporter_profiles.each do |profile| %>
      <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
        <!-- ユーザー情報 -->
        <div class="p-6">
          <div class="flex items-center mb-4">
            <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mr-4">
              <span class="text-indigo-600 font-bold text-lg">
                <%= profile.user.name&.first || "U" %>
              </span>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-gray-800"><%= profile.user.name || "匿名ユーザー" %></h3>
              <p class="text-sm text-gray-500"><%= profile.age_group %></p>
            </div>
          </div>

          <!-- 創作経験 -->
          <div class="mb-4">
            <h4 class="text-sm font-medium text-gray-700 mb-2">創作経験</h4>
            <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
              <%= profile.creation_experience %>
            </span>
          </div>

          <!-- よく見るジャンル -->
          <% if profile.interests.present? && profile.interests.any? %>
            <div class="mb-4">
              <h4 class="text-sm font-medium text-gray-700 mb-2">よく見るジャンル</h4>
              <div class="flex flex-wrap gap-1">
                <% profile.interests.first(3).each do |interest| %>
                  <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded">
                    <%= interest %>
                  </span>
                <% end %>
                <% if profile.interests.size > 3 %>
                  <span class="inline-block text-xs text-gray-500 px-2 py-1">
                    他<%= profile.interests.size - 3 %>件
                  </span>
                <% end %>
              </div>
            </div>
          <% end %>

          <!-- フィードバックできそうなこと -->
          <% if profile.favorite_artists.present? %>
            <div class="mb-4">
              <h4 class="text-sm font-medium text-gray-700 mb-2">フィードバックできそうなこと</h4>
              <p class="text-sm text-gray-600 line-clamp-3">
                <%= truncate(profile.favorite_artists, length: 120) %>
              </p>
            </div>
          <% end %>

          <!-- ユーザー詳細ボタン -->
          <div class="pt-4 border-t border-gray-200">
            <%= link_to user_path(profile.user), 
                class: "w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg text-center font-medium transition-colors block" do %>
              プロフィール詳細を見る
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- プロフィールが見つからない場合 -->
  <% if @supporter_profiles.empty? %>
    <div class="text-center py-12">
      <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">
        <% if params[:search].present? %>
          該当するサポーターが見つかりませんでした
        <% else %>
          まだサポータープロフィールが登録されていません
        <% end %>
      </h3>
      <p class="text-gray-600 mb-4">
        <% if params[:search].present? %>
          検索キーワードを変更してもう一度お試しください
        <% else %>
          最初のサポーターになりませんか？
        <% end %>
      </p>
      <% unless current_user.supporter_profile %>
        <%= link_to new_supporter_profile_path, 
            class: "inline-flex items-center bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors" do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
          サポータープロフィールを作成する
        <% end %>
      <% end %>
    </div>
  <% end %>

  <!-- ページネーション -->
  <% if @supporter_profiles.respond_to?(:total_pages) && @supporter_profiles.total_pages > 1 %>
    <div class="mt-8 text-center">
      <%= paginate @supporter_profiles %>
    </div>
  <% end %>
</div>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>